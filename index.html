<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Josephus Problem - Elite Visualizer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", "SF Pro Display", -apple-system,
          BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: radial-gradient(
          circle at 20% 50%,
          #0a0e27 0%,
          #000000 100%
        );
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        overflow-x: hidden;
        position: relative;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
            circle at 10% 20%,
            rgba(255, 59, 48, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 90% 80%,
            rgba(48, 209, 88, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 50% 50%,
            rgba(10, 132, 255, 0.02) 0%,
            transparent 50%
          );
        pointer-events: none;
        animation: ambientPulse 20s ease-in-out infinite;
      }

      @keyframes ambientPulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      .container {
        background: rgba(15, 15, 35, 0.85);
        border-radius: 32px;
        padding: 48px;
        box-shadow: 0 40px 80px rgba(0, 0, 0, 0.6),
          0 0 0 1px rgba(255, 255, 255, 0.05),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        max-width: 1600px;
        width: 100%;
        backdrop-filter: blur(40px) saturate(180%);
        position: relative;
        z-index: 1;
      }

      h1 {
        text-align: center;
        background: linear-gradient(
          135deg,
          #ff6b6b 0%,
          #ee5a6f 50%,
          #c44569 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: clamp(2rem, 5vw, 3.5rem);
        margin-bottom: 12px;
        font-weight: 900;
        letter-spacing: -1px;
        animation: titleFloat 3s ease-in-out infinite;
        text-shadow: 0 0 40px rgba(255, 107, 107, 0.3);
        filter: drop-shadow(0 4px 12px rgba(255, 107, 107, 0.2));
      }

      @keyframes titleFloat {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      .subtitle {
        text-align: center;
        color: #8892b0;
        margin-bottom: 40px;
        font-size: clamp(0.9rem, 2vw, 1.2rem);
        font-weight: 400;
        letter-spacing: 0.5px;
      }

      .controls {
        display: flex;
        gap: 24px;
        justify-content: center;
        margin-bottom: 32px;
        flex-wrap: wrap;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      label {
        font-weight: 600;
        color: #ccd6f6;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1.2px;
      }

      input[type="number"] {
        padding: 14px 20px;
        border: 2px solid rgba(255, 107, 107, 0.2);
        border-radius: 14px;
        font-size: 1.1rem;
        width: 140px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        background: rgba(255, 255, 255, 0.03);
        color: #fff;
        font-weight: 600;
      }

      input[type="number"]:hover {
        border-color: rgba(255, 107, 107, 0.4);
        background: rgba(255, 255, 255, 0.05);
      }

      input[type="number"]:focus {
        outline: none;
        border-color: #ff6b6b;
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.15);
        transform: translateY(-2px);
      }

      .button-group {
        display: flex;
        gap: 16px;
        justify-content: center;
        margin-bottom: 32px;
        flex-wrap: wrap;
      }

      button {
        padding: 16px 40px;
        border: none;
        border-radius: 14px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        text-transform: uppercase;
        letter-spacing: 1.2px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      }

      button::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      button:hover:not(:disabled)::before {
        width: 400px;
        height: 400px;
      }

      button span {
        position: relative;
        z-index: 1;
      }

      .start-btn {
        background: linear-gradient(135deg, #ff6b6b 0%, #c44569 100%);
        color: white;
        box-shadow: 0 8px 24px rgba(255, 107, 107, 0.35);
      }

      .start-btn:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 12px 32px rgba(255, 107, 107, 0.5);
      }

      .start-btn:active:not(:disabled) {
        transform: translateY(-1px);
      }

      .start-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .reset-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.35);
      }

      .reset-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 32px rgba(102, 126, 234, 0.5);
      }

      .speed-control {
        display: flex;
        align-items: center;
        gap: 16px;
        justify-content: center;
        margin-bottom: 24px;
        color: #ccd6f6;
        font-weight: 600;
      }

      .speed-control input[type="range"] {
        width: 240px;
        height: 8px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.08);
        outline: none;
        -webkit-appearance: none;
        transition: all 0.3s ease;
      }

      .speed-control input[type="range"]:hover {
        background: rgba(255, 255, 255, 0.12);
      }

      .speed-control input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff6b6b, #c44569);
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        transition: all 0.3s ease;
      }

      .speed-control input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.15);
        box-shadow: 0 6px 16px rgba(255, 107, 107, 0.6);
      }

      .speed-control input[type="range"]::-moz-range-thumb {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff6b6b, #c44569);
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        border: none;
        transition: all 0.3s ease;
      }

      .speed-control input[type="range"]::-moz-range-thumb:hover {
        transform: scale(1.15);
      }

      .canvas-container {
        position: relative;
        width: 100%;
        height: 700px;
        background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 100%);
        border-radius: 24px;
        overflow: visible;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6),
          0 0 0 1px rgba(255, 107, 107, 0.1);
        position: relative;
      }

      .canvas-container::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 24px;
        padding: 2px;
        background: linear-gradient(
          135deg,
          rgba(255, 107, 107, 0.3),
          rgba(196, 69, 105, 0.3)
        );
        -webkit-mask: linear-gradient(#fff 0 0) content-box,
          linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        opacity: 0.5;
      }

      .person {
        position: absolute;
        width: 90px;
        height: 130px;
        transform-origin: center center;
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        z-index: 10;
        filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
      }

      .person:hover:not(.eliminated) {
        transform: scale(1.08);
        z-index: 50;
      }

      .person .head {
        position: absolute;
        width: 46px;
        height: 46px;
        background: linear-gradient(135deg, #ffd89b 0%, #f4a460 100%);
        border-radius: 50%;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3),
          inset 0 2px 4px rgba(255, 255, 255, 0.3);
        border: 3px solid #d4915d;
        position: relative;
      }

      .person .head::before,
      .person .head::after {
        content: "";
        position: absolute;
        width: 7px;
        height: 7px;
        background: #1a1a2e;
        border-radius: 50%;
        top: 14px;
        animation: blink 4s infinite;
      }

      .person .head::before {
        left: 10px;
      }
      .person .head::after {
        right: 10px;
      }

      @keyframes blink {
        0%,
        96%,
        100% {
          transform: scaleY(1);
        }
        98% {
          transform: scaleY(0.1);
        }
      }

      .person .smile {
        position: absolute;
        width: 16px;
        height: 8px;
        border: 2px solid #1a1a2e;
        border-top: none;
        border-radius: 0 0 16px 16px;
        top: 26px;
        left: 50%;
        transform: translateX(-50%);
      }

      .person .body {
        position: absolute;
        width: 38px;
        height: 56px;
        background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
        top: 46px;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 18px 18px 6px 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3),
          inset 0 2px 4px rgba(255, 255, 255, 0.2);
      }

      .person .arm {
        position: absolute;
        width: 10px;
        height: 40px;
        background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
        border-radius: 5px;
        top: 50px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .person .arm.left {
        left: 16px;
        transform: rotate(-25deg);
        transform-origin: top center;
      }

      .person .arm.right {
        right: 16px;
        transform: rotate(25deg);
        transform-origin: top center;
      }

      .person .leg {
        position: absolute;
        width: 10px;
        height: 38px;
        background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
        border-radius: 5px;
        top: 95px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }

      .person .leg.left {
        left: 32px;
      }
      .person .leg.right {
        right: 32px;
      }

      .person .number {
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #ff6b6b 0%, #c44569 100%);
        color: white;
        min-width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 1rem;
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.5),
          0 0 0 3px rgba(255, 255, 255, 0.1);
        z-index: 100;
        transition: all 0.3s ease;
      }

      .person.holding-sword .arm.right {
        transform: rotate(-70deg) translateX(-8px);
      }

      .person.current {
        animation: personPulse 1s ease infinite;
        z-index: 60;
        filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.6));
      }

      .person.current .number {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        box-shadow: 0 0 24px rgba(255, 215, 0, 1),
          0 0 0 3px rgba(255, 255, 255, 0.2);
        animation: numberGlow 0.8s ease infinite;
      }

      @keyframes numberGlow {
        0%,
        100% {
          transform: translateX(-50%) scale(1);
        }
        50% {
          transform: translateX(-50%) scale(1.15);
        }
      }

      @keyframes personPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
      }

      .person.counting {
        animation: countBounce 0.4s ease;
        filter: drop-shadow(0 0 16px rgba(72, 198, 239, 0.8));
      }

      @keyframes countBounce {
        0%,
        100% {
          transform: scale(1) translateY(0);
        }
        50% {
          transform: scale(1.12) translateY(-8px);
        }
      }

      .person.counting .number {
        background: linear-gradient(135deg, #48c6ef 0%, #6f86d6 100%);
        box-shadow: 0 0 20px rgba(72, 198, 239, 0.8),
          0 0 0 3px rgba(255, 255, 255, 0.2);
      }

      .person.target {
        animation: targetShake 0.5s ease;
        filter: drop-shadow(0 0 24px rgba(255, 59, 48, 0.9));
      }

      @keyframes targetShake {
        0%,
        100% {
          transform: translate(0, 0) rotate(0deg);
        }
        10% {
          transform: translate(-6px, 0) rotate(-3deg);
        }
        20% {
          transform: translate(6px, 0) rotate(3deg);
        }
        30% {
          transform: translate(-6px, 0) rotate(-3deg);
        }
        40% {
          transform: translate(6px, 0) rotate(3deg);
        }
        50% {
          transform: translate(-4px, 0) rotate(-2deg);
        }
        60% {
          transform: translate(4px, 0) rotate(2deg);
        }
        70% {
          transform: translate(-3px, 0) rotate(-1deg);
        }
        80% {
          transform: translate(3px, 0) rotate(1deg);
        }
        90% {
          transform: translate(-2px, 0) rotate(-0.5deg);
        }
      }

      .person.eliminated {
        animation: deathFall 1.4s cubic-bezier(0.4, 0, 0.6, 1) forwards;
        z-index: 5;
      }

      @keyframes deathFall {
        0% {
          transform: rotate(0deg) scale(1);
          opacity: 1;
          filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
        }
        30% {
          transform: rotate(20deg) scale(0.98);
          opacity: 0.9;
        }
        60% {
          transform: rotate(75deg) scale(0.92) translateY(10px);
          opacity: 0.6;
        }
        100% {
          transform: rotate(95deg) translateY(25px) scale(0.85);
          opacity: 0.3;
          filter: grayscale(100%) drop-shadow(0 2px 6px rgba(0, 0, 0, 0.5));
        }
      }

      .person.eliminated .head,
      .person.eliminated .body,
      .person.eliminated .arm,
      .person.eliminated .leg {
        filter: grayscale(100%) brightness(0.5);
      }

      .person.eliminated .number {
        background: linear-gradient(135deg, #34495e, #2c3e50);
        box-shadow: none;
      }

      .person.eliminated::after {
        content: "✕";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 5rem;
        color: #e74c3c;
        text-shadow: 0 0 16px rgba(231, 76, 60, 1);
        animation: crossAppear 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.5s
          forwards;
        opacity: 0;
        z-index: 200;
        font-weight: 900;
      }

      @keyframes crossAppear {
        0% {
          transform: translate(-50%, -50%) scale(0) rotate(0deg);
          opacity: 0;
        }
        70% {
          transform: translate(-50%, -50%) scale(1.3) rotate(180deg);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(1) rotate(180deg);
          opacity: 1;
        }
      }

      .person.suicide {
        animation: suicideAnim 1.6s ease forwards;
      }

      @keyframes suicideAnim {
        0% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
        15% {
          transform: scale(1.08) rotate(-8deg);
        }
        30% {
          transform: scale(1.08) rotate(8deg);
        }
        45% {
          transform: scale(0.96) rotate(-4deg);
          opacity: 0.85;
        }
        60% {
          transform: scale(0.88) rotate(4deg);
          opacity: 0.7;
        }
        100% {
          transform: scale(0.7) rotate(0deg);
          opacity: 0.25;
          filter: grayscale(100%) brightness(0.4);
        }
      }

      .person.survivor {
        animation: victoryDance 1.2s ease infinite;
        z-index: 100;
        filter: drop-shadow(0 0 32px rgba(46, 204, 113, 1));
      }

      @keyframes victoryDance {
        0%,
        100% {
          transform: translateY(0) scale(1.3) rotate(0deg);
        }
        25% {
          transform: translateY(-12px) scale(1.32) rotate(-3deg);
        }
        50% {
          transform: translateY(-20px) scale(1.35) rotate(0deg);
        }
        75% {
          transform: translateY(-12px) scale(1.32) rotate(3deg);
        }
      }

      .person.survivor .number {
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        box-shadow: 0 0 40px rgba(46, 204, 113, 1),
          0 0 0 4px rgba(255, 255, 255, 0.3);
        animation: survivorGlow 1s ease infinite;
      }

      @keyframes survivorGlow {
        0%,
        100% {
          box-shadow: 0 0 30px rgba(46, 204, 113, 1),
            0 0 0 4px rgba(255, 255, 255, 0.3);
        }
        50% {
          box-shadow: 0 0 50px rgba(46, 204, 113, 1),
            0 0 0 6px rgba(255, 255, 255, 0.5);
        }
      }

      .person.survivor::before {
        content: "👑";
        position: absolute;
        top: -60px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 3rem;
        animation: crownFloat 2.5s ease infinite;
        filter: drop-shadow(0 4px 12px rgba(255, 215, 0, 0.6));
      }

      @keyframes crownFloat {
        0%,
        100% {
          transform: translateX(-50%) translateY(0) rotate(-8deg);
        }
        50% {
          transform: translateX(-50%) translateY(-12px) rotate(8deg);
        }
      }

      .sword {
        position: absolute;
        width: 90px;
        height: 14px;
        z-index: 150;
        transform-origin: center center;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: none;
        filter: drop-shadow(0 2px 8px rgba(255, 255, 255, 0.3));
      }

      .sword .blade {
        position: absolute;
        width: 68px;
        height: 10px;
        background: linear-gradient(
          90deg,
          #c0c0c0 0%,
          #ffffff 50%,
          #a0a0a0 100%
        );
        right: 0;
        top: 2px;
        clip-path: polygon(0 50%, 100% 0, 100% 100%);
        box-shadow: 0 0 16px rgba(255, 255, 255, 0.6);
        position: relative;
      }

      .sword .blade::before {
        content: "";
        position: absolute;
        width: 100%;
        height: 3px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.9),
          transparent
        );
        top: 3px;
        animation: bladeGlint 1.5s ease infinite;
      }

      @keyframes bladeGlint {
        0%,
        100% {
          opacity: 0.3;
          transform: translateX(-100%);
        }
        50% {
          opacity: 1;
          transform: translateX(100%);
        }
      }

      .sword .handle {
        position: absolute;
        width: 24px;
        height: 14px;
        background: linear-gradient(135deg, #8b4513 0%, #654321 100%);
        left: 0;
        top: 0;
        border-radius: 4px;
        box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.2);
      }

      .sword .guard {
        position: absolute;
        width: 8px;
        height: 24px;
        background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
        left: 22px;
        top: -5px;
        border-radius: 3px;
        box-shadow: 0 2px 6px rgba(255, 215, 0, 0.4);
      }

      .sword.slashing {
        animation: swordSlash 0.7s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes swordSlash {
        0% {
          transform: rotate(0deg) scale(1);
        }
        30% {
          transform: rotate(-60deg) scale(1.15);
        }
        60% {
          transform: rotate(-140deg) scale(1.25);
        }
        100% {
          transform: rotate(-200deg) scale(1);
        }
      }

      .sword.throwing {
        animation: swordThrow 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
      }

      @keyframes swordThrow {
        0% {
          transform: translate(0, 0) rotate(0deg) scale(1);
          opacity: 1;
        }
        100% {
          transform: translate(var(--throw-x), var(--throw-y)) rotate(900deg)
            scale(1.1);
          opacity: 1;
        }
      }

      .blood-splatter {
        position: absolute;
        width: 10px;
        height: 10px;
        background: radial-gradient(circle, #c0392b 0%, #8b0000 100%);
        border-radius: 50%;
        pointer-events: none;
        z-index: 100;
        box-shadow: 0 0 8px rgba(139, 0, 0, 1);
      }

      .blood-pool {
        position: absolute;
        width: 80px;
        height: 40px;
        background: radial-gradient(
          ellipse at center,
          rgba(139, 0, 0, 0.7) 0%,
          transparent 70%
        );
        border-radius: 50%;
        opacity: 0;
        animation: poolForm 1.2s ease forwards;
        z-index: 1;
      }

      @keyframes poolForm {
        0% {
          opacity: 0;
          transform: scale(0);
        }
        100% {
          opacity: 0.7;
          transform: scale(1);
        }
      }

      @keyframes bloodSplatter {
        0% {
          transform: translate(0, 0) scale(1);
          opacity: 1;
        }
        100% {
          transform: translate(var(--tx), var(--ty)) scale(0.2);
          opacity: 0;
        }
      }

      .count-indicator {
        position: absolute;
        top: -60px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #48c6ef, #6f86d6);
        color: white;
        padding: 8px 20px;
        border-radius: 24px;
        font-weight: 800;
        font-size: 1.3rem;
        box-shadow: 0 4px 16px rgba(72, 198, 239, 0.6),
          0 0 0 3px rgba(255, 255, 255, 0.2);
        animation: countBounceIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        z-index: 200;
      }

      @keyframes countBounceIn {
        0% {
          transform: translateX(-50%) scale(0);
          opacity: 0;
        }
        70% {
          transform: translateX(-50%) scale(1.2);
          opacity: 1;
        }
        100% {
          transform: translateX(-50%) scale(1);
          opacity: 1;
        }
      }

      .info-panel {
        margin-top: 32px;
        padding: 28px;
        background: rgba(15, 15, 35, 0.6);
        border-radius: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 20px;
        border: 1px solid rgba(255, 107, 107, 0.15);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      }

      .info-item {
        text-align: center;
        padding: 20px;
        background: rgba(26, 26, 46, 0.8);
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .info-item:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        border-color: rgba(255, 107, 107, 0.3);
      }

      .info-label {
        font-size: 0.8rem;
        color: #8892b0;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        margin-bottom: 8px;
        font-weight: 700;
      }

      .info-value {
        font-size: 2.2rem;
        font-weight: 900;
        background: linear-gradient(135deg, #ff6b6b, #c44569);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        filter: drop-shadow(0 2px 8px rgba(255, 107, 107, 0.3));
      }

      .elimination-log {
        margin-top: 28px;
        max-height: 180px;
        overflow-y: auto;
        padding: 20px;
        background: rgba(15, 15, 35, 0.6);
        border-radius: 16px;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.05);
        color: #ccd6f6;
      }

      .log-entry {
        padding: 12px 16px;
        margin: 8px 0;
        background: rgba(255, 107, 107, 0.08);
        border-left: 4px solid #ff6b6b;
        border-radius: 8px;
        animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 0.95rem;
        transition: all 0.3s ease;
      }

      .log-entry:hover {
        background: rgba(255, 107, 107, 0.15);
        transform: translateX(4px);
      }

      .log-entry.elimination {
        background: rgba(231, 76, 60, 0.15);
        border-left-color: #e74c3c;
      }

      .log-entry.survivor {
        background: rgba(46, 204, 113, 0.15);
        border-left-color: #2ecc71;
        font-weight: 700;
      }

      @keyframes slideIn {
        from {
          transform: translateX(-24px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      ::-webkit-scrollbar {
        width: 10px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #ff6b6b, #c44569);
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(255, 107, 107, 0.4);
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #ff7b7b, #d44579);
      }

      .victory-particle {
        position: absolute;
        pointer-events: none;
        z-index: 1000;
        font-size: 1.5rem;
        animation: victoryParticle 2s ease-out forwards;
      }

      @keyframes victoryParticle {
        0% {
          transform: translate(0, 0) scale(0) rotate(0deg);
          opacity: 0;
        }
        20% {
          opacity: 1;
        }
        100% {
          transform: translate(var(--tx), var(--ty)) scale(1) rotate(360deg);
          opacity: 0;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.5);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @media (max-width: 1200px) {
        .container {
          padding: 36px;
        }
        .canvas-container {
          height: 600px;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 24px;
        }

        .canvas-container {
          height: 500px;
        }

        .person {
          width: 70px;
          height: 100px;
        }

        .person .head {
          width: 36px;
          height: 36px;
        }

        .person .body {
          width: 30px;
          height: 44px;
        }

        .person .number {
          min-width: 30px;
          height: 30px;
          font-size: 0.9rem;
        }

        .info-panel {
          grid-template-columns: repeat(2, 1fr);
        }

        h1 {
          font-size: 2rem;
        }
      }

      @media (max-width: 480px) {
        .canvas-container {
          height: 400px;
        }

        .person {
          width: 55px;
          height: 80px;
        }

        .person .head {
          width: 28px;
          height: 28px;
        }

        .person .number {
          min-width: 26px;
          height: 26px;
          font-size: 0.8rem;
          top: -16px;
        }

        .controls {
          gap: 16px;
        }

        input[type="number"] {
          width: 110px;
          padding: 10px 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>⚔️ JOSEPHUS PROBLEM ⚔️</h1>
      <p class="subtitle">
        The Ancient Survival Game - Witness the circle of elimination
      </p>

      <div class="controls">
        <div class="input-group">
          <label for="n">Number of People (n)</label>
          <input type="number" id="n" min="2" max="30" value="12" />
        </div>
        <div class="input-group">
          <label for="k">Elimination Step (k)</label>
          <input type="number" id="k" min="1" max="20" value="3" />
        </div>
      </div>

      <div class="speed-control">
        <label>Animation Speed:</label>
        <input type="range" id="speed" min="1" max="10" value="5" />
        <span id="speedValue">5x</span>
      </div>

      <div class="button-group">
        <button class="start-btn" id="startBtn" onclick="startSimulation()">
          <span>▶ Start Simulation</span>
        </button>
        <button class="reset-btn" onclick="resetSimulation()">
          <span>↻ Reset</span>
        </button>
      </div>

      <div class="canvas-container" id="canvas"></div>

      <div class="info-panel">
        <div class="info-item">
          <div class="info-label">Total People</div>
          <div class="info-value" id="totalPeople">0</div>
        </div>
        <div class="info-item">
          <div class="info-label">Eliminated</div>
          <div class="info-value" id="eliminated">0</div>
        </div>
        <div class="info-item">
          <div class="info-label">Remaining</div>
          <div class="info-value" id="remaining">0</div>
        </div>
        <div class="info-item">
          <div class="info-label">Survivor</div>
          <div class="info-value" id="survivor">-</div>
        </div>
      </div>

      <div class="elimination-log" id="log">
        <strong>📜 Elimination Chronicle:</strong>
      </div>
    </div>

    <script>
      let people = [];
      let isRunning = false;
      let animationSpeed = 1000;
      let eliminationCount = 0;
      let sword = null;

      const canvas = document.getElementById("canvas");
      const logElement = document.getElementById("log");
      const speedSlider = document.getElementById("speed");
      const speedValue = document.getElementById("speedValue");
      const startBtn = document.getElementById("startBtn");

      speedSlider.addEventListener("input", (e) => {
        const speed = e.target.value;
        speedValue.textContent = speed + "x";
        animationSpeed = 2000 / speed;
      });

      function createPersonElement(id, x, y, index, total) {
        const person = document.createElement("div");
        person.className = "person";
        person.style.left = x - 45 + "px";
        person.style.top = y - 65 + "px";
        person.style.animation = `fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) ${
          index * 0.06
        }s backwards`;

        person.innerHTML = `
          <div class="number">${id}</div>
          <div class="head">
            <div class="smile"></div>
          </div>
          <div class="body"></div>
          <div class="arm left"></div>
          <div class="arm right"></div>
          <div class="leg left"></div>
          <div class="leg right"></div>
        `;

        return person;
      }

      function createSword() {
        const swordEl = document.createElement("div");
        swordEl.className = "sword";
        swordEl.innerHTML = `
          <div class="handle"></div>
          <div class="guard"></div>
          <div class="blade"></div>
        `;
        swordEl.style.opacity = "0";
        canvas.appendChild(swordEl);
        return swordEl;
      }

      function positionSword(person, angle = 0) {
        if (!sword) return;
        sword.style.left = person.x + 35 + "px";
        sword.style.top = person.y - 25 + "px";
        sword.style.transform = `rotate(${angle}rad)`;
        sword.style.opacity = "1";
      }

      function calculateDistance(p1, p2) {
        const dx = p2.x - p1.x;
        const dy = p2.y - p1.y;
        return Math.sqrt(dx * dx + dy * dy);
      }

      async function throwSword(fromPerson, toPerson) {
        const dx = toPerson.x - fromPerson.x;
        const dy = toPerson.y - fromPerson.y;

        sword.style.setProperty("--throw-x", dx + "px");
        sword.style.setProperty("--throw-y", dy + "px");
        sword.classList.add("throwing");

        await sleep(900);
        sword.classList.remove("throwing");

        const angle = Math.atan2(dy, dx);
        positionSword(toPerson, angle);
      }

      async function slashSword() {
        sword.classList.add("slashing");
        await sleep(700);
        sword.classList.remove("slashing");
      }

      function createBloodSplatter(x, y) {
        for (let i = 0; i < 25; i++) {
          const splatter = document.createElement("div");
          splatter.className = "blood-splatter";

          const angle = (Math.PI * 2 * i) / 25 + Math.random() * 0.3;
          const distance = 35 + Math.random() * 60;
          const tx = Math.cos(angle) * distance;
          const ty = Math.sin(angle) * distance;

          splatter.style.left = x + "px";
          splatter.style.top = y + "px";
          splatter.style.setProperty("--tx", tx + "px");
          splatter.style.setProperty("--ty", ty + "px");
          splatter.style.animation = `bloodSplatter ${
            0.9 + Math.random() * 0.5
          }s cubic-bezier(0.4, 0, 0.6, 1) forwards`;

          canvas.appendChild(splatter);

          setTimeout(() => splatter.remove(), 1400);
        }

        const pool = document.createElement("div");
        pool.className = "blood-pool";
        pool.style.left = x - 40 + "px";
        pool.style.top = y + 25 + "px";
        canvas.appendChild(pool);
      }

      function showCountIndicator(person, count) {
        const indicator = document.createElement("div");
        indicator.className = "count-indicator";
        indicator.textContent = count;
        person.element.appendChild(indicator);

        setTimeout(() => {
          indicator.remove();
        }, 500);
      }

      function updateInfo() {
        const n = parseInt(document.getElementById("n").value) || 0;
        const remaining = people.filter((p) => !p.eliminated).length;

        document.getElementById("totalPeople").textContent = n;
        document.getElementById("eliminated").textContent = eliminationCount;
        document.getElementById("remaining").textContent = remaining;
      }

      function addLog(message, type = "") {
        const entry = document.createElement("div");
        entry.className = "log-entry " + type;
        entry.textContent = message;
        logElement.appendChild(entry);
        logElement.scrollTop = logElement.scrollHeight;
      }

      function createPeople(n) {
        canvas.innerHTML = "";
        people = [];
        eliminationCount = 0;
        sword = null;

        const centerX = canvas.offsetWidth / 2;
        const centerY = canvas.offsetHeight / 2;
        const radius = Math.min(centerX, centerY) - 120;

        for (let i = 0; i < n; i++) {
          const angle = (i * 2 * Math.PI) / n - Math.PI / 2;
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);

          const personEl = createPersonElement(i + 1, x, y, i, n);
          canvas.appendChild(personEl);

          people.push({
            id: i + 1,
            element: personEl,
            x: x,
            y: y,
            eliminated: false,
          });
        }

        updateInfo();
        logElement.innerHTML = "<strong>📜 Elimination Chronicle:</strong>";
        addLog(`⚡ ${n} warriors have entered the circle of fate`);
      }

      async function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      async function startSimulation() {
        if (isRunning) return;

        const n = parseInt(document.getElementById("n").value);
        const k = parseInt(document.getElementById("k").value);

        if (n < 2 || k < 1) {
          alert("Please enter valid values (n ≥ 2, k ≥ 1)");
          return;
        }

        isRunning = true;
        startBtn.disabled = true;
        eliminationCount = 0;
        createPeople(n);
        await sleep(1200);

        if (k === 1) {
          addLog(
            `💀 k=1: Each warrior must take their own life...`,
            "elimination"
          );
        } else {
          addLog(
            `⚔️ The elimination begins! Every ${k}th person will be eliminated`,
            "elimination"
          );
        }
        await sleep(600);

        sword = createSword();

        let alivePeople = [...people];
        let currentIndex = 0;

        while (alivePeople.length > 1) {
          const holder = alivePeople[currentIndex];

          holder.element.classList.add("current", "holding-sword");
          positionSword(holder);

          if (k === 1) {
            addLog(
              `🗡️ Warrior ${holder.id} must eliminate themselves...`,
              "elimination"
            );
            await sleep(animationSpeed * 0.6);

            holder.element.classList.add("suicide");
            await slashSword();
            createBloodSplatter(holder.x, holder.y);
            await sleep(animationSpeed * 0.9);

            holder.element.classList.remove("current", "holding-sword");
            holder.eliminated = true;
            eliminationCount++;
            updateInfo();

            alivePeople.splice(currentIndex, 1);

            if (alivePeople.length > 0) {
              currentIndex = currentIndex % alivePeople.length;
              if (alivePeople.length > 1) {
                const nextHolder = alivePeople[currentIndex];
                await throwSword(holder, nextHolder);
              }
            }
          } else {
            addLog(`🗡️ Warrior ${holder.id} begins counting...`);
            await sleep(animationSpeed * 0.45);

            let countIndex = currentIndex;
            for (let count = 1; count <= k; count++) {
              const countedPerson = alivePeople[countIndex];
              countedPerson.element.classList.add("counting");
              showCountIndicator(countedPerson, count);

              if (count < k) {
                await sleep(animationSpeed * 0.28);
                countedPerson.element.classList.remove("counting");
                countIndex = (countIndex + 1) % alivePeople.length;
              } else {
                await sleep(animationSpeed * 0.35);
              }
            }

            const victimIndex = (currentIndex + k - 1) % alivePeople.length;
            const victim = alivePeople[victimIndex];

            victim.element.classList.remove("counting");
            victim.element.classList.add("target");

            addLog(
              `💀 Warrior ${holder.id} has chosen Warrior ${victim.id} for elimination!`,
              "elimination"
            );
            await sleep(animationSpeed * 0.55);

            const distance = calculateDistance(holder, victim);
            const threshold = 160;

            if (distance > threshold && holder.id !== victim.id) {
              addLog(
                `🎯 Warrior ${holder.id} throws the sword at Warrior ${victim.id}!`
              );
              await throwSword(holder, victim);
              victim.element.classList.add("holding-sword");
              await sleep(animationSpeed * 0.35);
            }

            await slashSword();
            createBloodSplatter(victim.x, victim.y);

            await sleep(animationSpeed * 0.35);

            victim.element.classList.remove(
              "target",
              "counting",
              "current",
              "holding-sword"
            );
            victim.element.classList.add("eliminated");
            victim.eliminated = true;
            eliminationCount++;

            addLog(`⚰️ Warrior ${victim.id} has fallen`, "elimination");
            updateInfo();

            await sleep(animationSpeed * 0.7);

            alivePeople.splice(victimIndex, 1);

            if (alivePeople.length > 0) {
              currentIndex = victimIndex % alivePeople.length;

              if (alivePeople.length > 1) {
                holder.element.classList.remove("current", "holding-sword");
                const nextHolder = alivePeople[currentIndex];

                const dist = calculateDistance(victim, nextHolder);
                if (dist > threshold) {
                  await throwSword(victim, nextHolder);
                } else {
                  positionSword(nextHolder);
                }
                await sleep(animationSpeed * 0.25);
              }
            }
          }
        }

        if (alivePeople.length === 1) {
          const survivor = alivePeople[0];
          survivor.element.classList.remove("current", "holding-sword");

          if (sword) {
            sword.style.opacity = "0";
          }

          await sleep(900);

          survivor.element.classList.add("survivor");
          document.getElementById("survivor").textContent = survivor.id;
          addLog(
            `👑 WARRIOR ${survivor.id} IS THE SOLE SURVIVOR! 👑`,
            "survivor"
          );

          for (let i = 0; i < 40; i++) {
            setTimeout(() => {
              createVictoryParticles(survivor.x, survivor.y);
            }, i * 80);
          }
        }

        isRunning = false;
        startBtn.disabled = false;
      }

      function createVictoryParticles(x, y) {
        const emojis = ["✨", "⭐", "💫", "🌟", "💥", "👑", "🏆", "🎉"];

        for (let i = 0; i < 10; i++) {
          const particle = document.createElement("div");
          particle.className = "victory-particle";
          particle.textContent =
            emojis[Math.floor(Math.random() * emojis.length)];

          const angle = (Math.PI * 2 * i) / 10 + Math.random() * 0.5;
          const distance = 50 + Math.random() * 80;
          const tx = Math.cos(angle) * distance;
          const ty = Math.sin(angle) * distance - 40;

          particle.style.left = x + "px";
          particle.style.top = y + "px";
          particle.style.setProperty("--tx", tx + "px");
          particle.style.setProperty("--ty", ty + "px");

          canvas.appendChild(particle);
          setTimeout(() => particle.remove(), 2000);
        }
      }

      function resetSimulation() {
        isRunning = false;
        startBtn.disabled = false;
        eliminationCount = 0;
        canvas.innerHTML = "";
        people = [];
        sword = null;
        document.getElementById("survivor").textContent = "-";
        logElement.innerHTML = "<strong>📜 Elimination Chronicle:</strong>";
        updateInfo();

        const n = parseInt(document.getElementById("n").value);
        if (n >= 2) {
          createPeople(n);
        }
      }

      window.addEventListener("load", () => {
        const n = parseInt(document.getElementById("n").value);
        createPeople(n);
      });

      document.getElementById("n").addEventListener("change", (e) => {
        if (!isRunning) {
          const n = parseInt(e.target.value);
          if (n >= 2 && n <= 30) {
            createPeople(n);
          }
        }
      });
    </script>
  </body>
</html>
